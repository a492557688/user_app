02-15 20:00:11 PM - INFO -mysql_db:  初始化MYSQL错误：sql DB 必须选择否则创建失败
02-15 20:01:49 PM - INFO -mysql_db:  初始化MYSQL错误：sql DB 必须选择否则创建失败
02-15 20:03:39 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:03:40 PM - INFO -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
02-15 20:04:18 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:04:18 PM - INFO -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
02-15 20:07:53 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:07:53 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 143, in __init__
    self._db = Mysql(dbname=dbname if  dbname else self._db_name, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 42, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:08:29 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:08:29 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 143, in __init__
    self._db = Mysql(dbname=dbname if  dbname else self._db_name, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 42, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:10:44 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:10:44 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 144, in __init__
    self._db = Mysql(dbname=dbname if  dbname else self._db_name, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 43, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:12:31 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:12:31 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 143, in __init__
    self._db = Mysql(dbname=dbname, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 42, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:13:15 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:13:16 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

02-15 20:13:17 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:13:17 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'ott_warning.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'ott_warning.tb_domain' doesn't exist")
02-15 20:14:20 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:14:21 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

02-15 20:14:21 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:14:21 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:15:08 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:15:08 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:16:33 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:16:33 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 65, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:17:52 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:17:52 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:18:32 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:18:32 PM - ERROR -mysql_db:  初始化MYSQL错误：[Errno 2] No such file or directory: '../config/a.sql'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 147, in __init__
    sqls = readConfig('a.sql')
  File "C:\Users\Administrator\PycharmProjects\teas\tools\config.py", line 4, in readConfig
    with open(filename, encoding='utf-8') as f:
FileNotFoundError: [Errno 2] No such file or directory: '../config/a.sql'
02-15 20:18:48 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:18:48 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

02-15 20:18:48 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:18:48 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:32:00 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:32:00 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:38:32 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:38:32 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:38:43 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:38:43 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8mb4;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

02-15 20:38:43 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:38:43 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:39:02 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:39:02 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8mb4;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8mb4;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

02-15 20:39:03 PM - DEBUG -mysql_db:  [script] spent time: 0.51
02-15 20:40:28 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
