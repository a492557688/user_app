02-15 20:00:11 PM - INFO -mysql_db:  初始化MYSQL错误：sql DB 必须选择否则创建失败
02-15 20:01:49 PM - INFO -mysql_db:  初始化MYSQL错误：sql DB 必须选择否则创建失败
02-15 20:03:39 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:03:40 PM - INFO -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
02-15 20:04:18 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:04:18 PM - INFO -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
02-15 20:07:53 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:07:53 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 143, in __init__
    self._db = Mysql(dbname=dbname if  dbname else self._db_name, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 42, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:08:29 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:08:29 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 143, in __init__
    self._db = Mysql(dbname=dbname if  dbname else self._db_name, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 42, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:10:44 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:10:44 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 144, in __init__
    self._db = Mysql(dbname=dbname if  dbname else self._db_name, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 43, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:12:31 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:12:31 PM - ERROR -mysql_db:  初始化MYSQL错误：'Mysql' object has no attribute '_db_name'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 143, in __init__
    self._db = Mysql(dbname=dbname, day=daily)
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 14, in __init__
    self._connect()
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 36, in _connect
    if not self.databaseExists():
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 42, in databaseExists
    sql = f"SELECT * FROM information_schema.SCHEMATA where SCHEMA_NAME='{self._db_name}';"
AttributeError: 'Mysql' object has no attribute '_db_name'
02-15 20:13:15 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:13:16 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

02-15 20:13:17 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:13:17 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'ott_warning.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'ott_warning.tb_domain' doesn't exist")
02-15 20:14:20 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:14:21 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

02-15 20:14:21 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:14:21 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:15:08 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:15:08 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:16:33 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:16:33 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 65, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:17:52 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:17:52 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:18:32 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:18:32 PM - ERROR -mysql_db:  初始化MYSQL错误：[Errno 2] No such file or directory: '../config/a.sql'
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 147, in __init__
    sqls = readConfig('a.sql')
  File "C:\Users\Administrator\PycharmProjects\teas\tools\config.py", line 4, in readConfig
    with open(filename, encoding='utf-8') as f:
FileNotFoundError: [Errno 2] No such file or directory: '../config/a.sql'
02-15 20:18:48 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:18:48 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8;

02-15 20:18:48 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:18:48 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "C:\Users\Administrator\PycharmProjects\teas\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:32:00 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:32:00 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:38:32 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:38:32 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:38:43 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:38:43 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8mb4;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

02-15 20:38:43 PM - ERROR -mysql_db:  exception:(3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.") [rollback] 
/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8 
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 92, in script
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 329, in _query
    self._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 391, in _do_get_result
    super(DictCursorMixin, self)._do_get_result()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 353, in _do_get_result
    self._show_warnings()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 369, in _show_warnings
    warnings.warn(err.Warning(*w[1:3]), stacklevel=4)
pymysql.err.Warning: (3719, "'utf8' is currently an alias for the character set UTF8MB3, but will be an alias for UTF8MB4 in a future release. Please consider using UTF8MB4 in order to be unambiguous.")
02-15 20:38:43 PM - ERROR -mysql_db:  FAILED sql=select * from tb_domain  where 1=1 , exception:(1146, "Table 'app.tb_domain' doesn't exist")
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 64, in query
    self._cursor.execute(sql)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.ProgrammingError: (1146, "Table 'app.tb_domain' doesn't exist")
02-15 20:39:02 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 20:39:02 PM - INFO -mysql_db:  
-------------------- 初始化SQL数据库 --------------------

/*=================================================================*/
/* Table: tb_stat 统计表                                           */
/*=================================================================*/
CREATE TABLE `tb_stat` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `dnsanalysuccrate` float(100,2) DEFAULT NULL,      # DNS解析成功率
  `dnsanalydelay` float(100,2) DEFAULT NULL,         # DNS平均解析时延(ms)
  `buildlinksuccrate` float(100,2) DEFAULT NULL,     # TCP建立成功率
  `buildlinkdelay` float(100,2) DEFAULT NULL,        # TCP建链平均时延
  `firstpacketdelay` float(100,2) DEFAULT NULL,      # 首包平均时延
  `respsuccrate` float(100,2) DEFAULT NULL,          # HTTP响应成功率
  `replydelay` float(100,2) DEFAULT NULL,            # HTTP平均响应时延
  `downrate` float(100,2) DEFAULT NULL,              # URL平均下载速率 kps
  `sumflow` float(100,2) DEFAULT NULL,               # 业务总流量(kb)
  `clipacketlossrate` float(100,2) DEFAULT NULL,     # 上行丢包率
  `srvpacketlossrate` float(100,2) DEFAULT NULL,     # 下行丢包率
  `clilittlewinnb` varchar(255) DEFAULT NULL,        # 上行窗口累计过小数量
  `srvlittlewinnb` varchar(255) DEFAULT NULL,        # 下行窗口累计过小数量
  `cliretranspkts` varchar(255) DEFAULT NULL,        # 上行累计重传数量
  `srvretranspkts` varchar(255) DEFAULT NULL,        # 下行累计重传数量
  `clirstcnt` varchar(255) DEFAULT NULL,             # 上行累计重置数量
  `srvrstcnt` varchar(255) DEFAULT NULL,             # 下行累计重置数量
  `grade` varchar(255) DEFAULT NULL,                 # 得分
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=6096 DEFAULT CHARSET=utf8mb4;


/*=================================================================*/
/* Table: tb_http http信息表                                       */
/*=================================================================*/
CREATE TABLE `tb_http` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `attribution` varchar(100) DEFAULT NULL,           # 服务端IP归属地
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端IP运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延（ms）
  `respcode` varchar(100) DEFAULT NULL,              # HTTP响应码
  `firstpackdelay` float(100,2) DEFAULT NULL,        # 首包时延（ms）
  `downrate` float(100,2) DEFAULT NULL,              # 下载速率(kb/s)
  `cliretranspkts_rate` float(100,2) DEFAULT NULL,   # 上行丢包率
  `srvretranspkts_rate` float(100,2) DEFAULT NULL,   # 下行丢包率
  `clilittlewinnb` varchar(100) DEFAULT NULL,        # 上行窗口过小数量
  `srvlittlewinnb` varchar(100) DEFAULT NULL,        # 下行窗口过小数量
  `cliretranspkts` varchar(100) DEFAULT NULL,        # 上行重传数量
  `srvretranspkts` varchar(100) DEFAULT NULL,        # 下行重传数量
  `clirstcnt` varchar(100) DEFAULT NULL,             # 上行重置数量
  `srvrstcnt` varchar(100) DEFAULT NULL,             # 下行重置数量
  `urlfilesize` float(100,2) DEFAULT NULL,           # URL文件大小（kb）
  `btime` varchar(255) DEFAULT NULL,                 # 起始时间
  `etime` varchar(255) DEFAULT NULL,                 # 结束时间
  `clicachecontrol` varchar(255) DEFAULT NULL,       # 客户端CACHE_CONTROL
  `srvcachecontrol` varchar(255) DEFAULT NULL,       # 服务端CACHE_CONTROL
  `clicontenttype` varchar(255) DEFAULT NULL,        # 客户端CONTENT_TYPE
  `srvcontenttype` varchar(255) DEFAULT NULL,        # 服务端CONTENT_TYPE
  `srvcookie` varchar(255) DEFAULT NULL,             # COOKIE
  `typedsp` varchar(100) DEFAULT NULL,               # 文件类型
  `linknum` int(100) DEFAULT NULL,                   # 所属TCP链路编号（暂不使用）
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=502248 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_signal 信令表                                         */
/*=================================================================*/
CREATE TABLE `tb_signal` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT NULL,                  # 所属任务编号
  `url` text,                                        # url domain+content
  `protocol` varchar(100) DEFAULT NULL,              # 协议类型 TCP/UDP
  `halength` float(100,2) DEFAULT NULL,              # 长度(B)
  `cliip` varchar(100) DEFAULT NULL,                 # 客户端 IP
  `cli_attribution` varchar(100) DEFAULT NULL,       # 客户端地址归属地
  `srvip` varchar(100) DEFAULT NULL,                 # 服务端IP
  `srv_attribution` varchar(100) DEFAULT NULL,       # 服务端地址归属地
  `cli_t_mobile` varchar(100) DEFAULT NULL,          # 客户端运营商
  `replydelay` float(100,2) DEFAULT NULL,            # 响应时延
  `succrate` float(10,2) DEFAULT NULL,               # 成功率
  `respcode` varchar(100) DEFAULT NULL,              # 响应码
  `cli_port` varchar(10) DEFAULT NULL,               # 客户端端口号
  `srv_port` varchar(10) DEFAULT NULL,               # 服务端端口号
  `t_mobile` varchar(100) DEFAULT NULL,              # 服务端运营商
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=674223 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_domain 域名信息表                                     */
/*=================================================================*/
CREATE TABLE `tb_domain` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `uuid` varchar(255) DEFAULT '',                    # 所属任务编号
  `domain` varchar(100) DEFAULT '',                  # 域名
  `ip` varchar(100) DEFAULT '',                      # 服务端IP
  `t_mobile` varchar(100) DEFAULT '',                # 服务端运营商
  `company` varchar(100) DEFAULT '',                 # 域名归属公司
  `dnsreplydelay` float(100,2) DEFAULT NULL,         # DNS解析时延
  `tcpbuilddelay` float(100,2) DEFAULT NULL,         # TCP建链时延
  `dns_suc_rate` float(100,2) DEFAULT NULL,          # DNS解析成功率
  `tcp_suc_rate` float(100,2) DEFAULT NULL,          # TCP建立成功率
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=92160 DEFAULT CHARSET=utf8mb4;







/*=================================================================*/
/* Table: tb_overview 概观表                                       */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_overview(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	litfiledownrate float(100,3) NOT NULL,    # 小文件下载速率，kb/s
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_buildlink TCP建链成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_buildlink(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	buildlinkcnt int(10) NOT NULL,            # 建链请求次数
	buildlinksuccrate float(10,3) NOT NULL,   # TCP建链成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_httpresp HTTP影响成功率表                             */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_httpresp(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	httpreqcnt int(10) NOT NULL,              # HTTP请求次数
	respsuccrate float(10,3) NOT NULL,        # HTTP影响成功率，%
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_litrate 小文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_litrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	littlefiledownrate float(100,3) NOT NULL, # 小文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_bigrate 大文件下载速率表                              */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_bigrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,               # 所属任务编号
	srvip varchar(15) NOT NULL,               # 服务端IP
	domain varchar(255) NOT NULL,             # 请求域名
	bigfiledownrate float(100,3) NOT NULL,    # 大文件下载速率，kb/s
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_repcode URL应答码表，tb_httpresp表的下转              */
/* 通过srvip,domain两字段与tb_httpresp表数据对应                   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_repcode(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	respcode varchar(3) NOT NULL,          # HTTP应答码
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_urlrate URL下载速率表，tb_litrate，tb_bigrate表的下转 */
/* 通过type,srvip,domain三字段与tb_litrate，tb_bigrate表数据对应   */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_urlrate(
	id int(11) NOT NULL AUTO_INCREMENT,
	uuid varchar(255) NOT NULL,            # 所属任务编号
	type int NOT NULL,                     # 0表示小文件URL，1表示大文件URL
	srvip varchar(15) NOT NULL,            # 服务端IP
	domain varchar(255) NOT NULL,          # 请求域名
	url varchar(255) NOT NULL,             # URL
	downrate float(100,3) NOT NULL,        # URL下载速率，kb/s
	urlfilesize float(100,3) NOT NULL,     # URL文件大小 kb
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

/*=================================================================*/
/* Table: tb_top_url 每天按应用类型统计的TOP100URL表               */
/*=================================================================*/
CREATE TABLE IF NOT EXISTS tb_top_url(
	id int(11) NOT NULL AUTO_INCREMENT,
	date varchar(10) NOT NULL,             # 日期
	type varchar(255) NOT NULL,            # 应用类型
	url varchar(255) NOT NULL,             # URL
	count int(11) NOT NULL,                # URL访问次数
	PRIMARY KEY (id)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8mb4;

02-15 20:39:03 PM - DEBUG -mysql_db:  [script] spent time: 0.51
02-15 20:40:28 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:45:43 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:46:01 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:46:01 PM - ERROR -mysql_db:  exception:not enough arguments for format string [rollback] sql:INSERT INTO tb_domain (uuid,domain,ip,t_modbile,company,dnsreplydelay,tcpbuilddelay,dns_suc_rate,tcp_suc_rate) values(%s,%s,%s,%s,%s,%s,%s,%s,%s)
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 75, in update
    self._cursor.executemany(sql, args)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 197, in executemany
    self._get_db().encoding)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 213, in _do_execute_many
    v = values % escape(next(args), conn)
TypeError: not enough arguments for format string
02-15 21:46:01 PM - ERROR -mysql_db:  ['cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.cloud.huawei.com', None, '未知', 23.1, 12.5, 40.91, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.cloud.huawei.com', None, '未知', 23.1, 12.5, 41.89, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'dns.weixin.qq.com', None, '未知', 21.04, 16.67, 85.18, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 37.84, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'loc.map.baidu.com', None, '未知', 22.41, 33.33, 21.01, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'loc.map.baidu.com', None, '未知', 22.41, 33.33, 18.14, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'ti-in-f108.1e100.net', None, '未知', 88.64, 100.0, 0, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'ti-in-f108.1e100.net', None, '未知', 88.64, 100.0, 0, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'www.taobao.com', None, '未知', 25.87, 33.33, 27.29, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'restapi.amap.com', None, '未知', 33.39, 33.33, 13.83, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 23.4, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'metrics1.data.hicloud.com', None, '未知', 32.89, 33.33, 36.01, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'apilocate.amap.com', None, '未知', 24.25, 33.33, 13.51, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'apilocate.amap.com', None, '未知', 24.25, 33.33, 28.27, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', None, '未知', 24.48, 33.33, 39.11, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', None, '未知', 24.48, 33.33, 43.03, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'control.aps.amap.com', None, '未知', 16.73, 100.0, 60.76, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', None, '未知', 24.48, 33.33, 52.52, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'data.hicloud.com', None, '未知', 21.41, 33.33, 0, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.map.baidu.com', None, '未知', 26.23, 33.33, 18.68, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'download.alicdn.com', None, '未知', 26.67, 33.33, 33.61, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'data.hicloud.com', None, '未知', 21.41, 33.33, 37.73, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'mobilecns.alipay.com', None, '未知', 22.43, 100.0, 11.7, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'applog.uc.cn', None, '未知', 39.27, 100.0, 54.37, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 27.84, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'mdap.alipay.com', None, '未知', 32.28, 100.0, 15.47, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'applog.uc.cn', None, '未知', 39.27, 100.0, 45.15, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'entphz.alipay.com', None, '未知', 24.22, 100.0, 0, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'oauth-login.platform.hicloud.com', None, '未知', 32.94, 100.0, 49.42, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'setting1.hicloud.com', None, '未知', 20.74, 100.0, 22.98, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'grs.dbankcloud.com', None, '未知', 28.02, 100.0, 48.24, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'hihealthbase-drcn.things.hicloud.com', None, '未知', 23.25, 100.0, 39.07, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'hihealthbase-drcn.things.hicloud.com', None, '未知', 23.25, 100.0, 38.78, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 42.24, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 44.74, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 34.45, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'render.yunfengdie.cn', None, '未知', 104.7, 100.0, 42.95, 0, 'cad50fe2-9e34-023f-2d29-99d1988026ac', 'res.wx.qq.com', None, '未知', 22.77, 100.0, 38.65, 0]
02-15 21:47:07 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:47:07 PM - ERROR -mysql_db:  exception:'generator' object has no attribute 'translate' [rollback] sql:INSERT INTO tb_domain (uuid,domain,ip,t_modbile,company,dnsreplydelay,tcpbuilddelay,dns_suc_rate,tcp_suc_rate) values(%s,%s,%s,%s,%s,%s,%s,%s,%s)
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 75, in update
    self._cursor.executemany(sql, args)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 197, in executemany
    self._get_db().encoding)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 213, in _do_execute_many
    v = values % escape(next(args), conn)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 133, in _escape_args
    return conn.escape(args)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 460, in escape
    return converters.escape_item(obj, self.charset, mapping=mapping)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\converters.py", line 27, in escape_item
    val = encoder(val, mapping)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\converters.py", line 118, in escape_unicode
    return u"'%s'" % _escape_unicode(value)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\converters.py", line 73, in _escape_unicode
    return value.translate(_escape_table)
AttributeError: 'generator' object has no attribute 'translate'
02-15 21:47:07 PM - ERROR -mysql_db:  [<generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC370>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC3B0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC3F0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC430>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC470>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC4B0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC4F0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC530>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC570>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC5F0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC630>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC670>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC6B0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC6F0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC730>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC770>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC7B0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC5B0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC7F0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC830>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC870>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC8B0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC8F0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC930>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC970>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC9B0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EAC9F0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACA30>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACA70>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACAB0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACAF0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACB30>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACB70>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACBB0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACBF0>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACC30>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACC70>, <generator object Domain.insert_data.<locals>.<listcomp>.<genexpr> at 0x02EACCB0>]
02-15 21:47:30 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:47:30 PM - ERROR -mysql_db:  exception:not enough arguments for format string [rollback] sql:INSERT INTO tb_domain (uuid,domain,ip,t_modbile,company,dnsreplydelay,tcpbuilddelay,dns_suc_rate,tcp_suc_rate) values(%s,%s,%s,%s,%s,%s,%s,%s,%s)
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 75, in update
    self._cursor.executemany(sql, args)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 197, in executemany
    self._get_db().encoding)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 213, in _do_execute_many
    v = values % escape(next(args), conn)
TypeError: not enough arguments for format string
02-15 21:47:30 PM - ERROR -mysql_db:  [('cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.cloud.huawei.com', None, '未知', 23.1, 12.5, 40.91, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.cloud.huawei.com', None, '未知', 23.1, 12.5, 41.89, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'dns.weixin.qq.com', None, '未知', 21.04, 16.67, 85.18, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 37.84, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'loc.map.baidu.com', None, '未知', 22.41, 33.33, 21.01, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'loc.map.baidu.com', None, '未知', 22.41, 33.33, 18.14, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'ti-in-f108.1e100.net', None, '未知', 88.64, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'ti-in-f108.1e100.net', None, '未知', 88.64, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'www.taobao.com', None, '未知', 25.87, 33.33, 27.29, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'restapi.amap.com', None, '未知', 33.39, 33.33, 13.83, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 23.4, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'metrics1.data.hicloud.com', None, '未知', 32.89, 33.33, 36.01, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'apilocate.amap.com', None, '未知', 24.25, 33.33, 13.51, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'apilocate.amap.com', None, '未知', 24.25, 33.33, 28.27, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', None, '未知', 24.48, 33.33, 39.11, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', None, '未知', 24.48, 33.33, 43.03, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'control.aps.amap.com', None, '未知', 16.73, 100.0, 60.76, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', None, '未知', 24.48, 33.33, 52.52, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'data.hicloud.com', None, '未知', 21.41, 33.33, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.map.baidu.com', None, '未知', 26.23, 33.33, 18.68, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'download.alicdn.com', None, '未知', 26.67, 33.33, 33.61, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'data.hicloud.com', None, '未知', 21.41, 33.33, 37.73, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'mobilecns.alipay.com', None, '未知', 22.43, 100.0, 11.7, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'applog.uc.cn', None, '未知', 39.27, 100.0, 54.37, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 27.84, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'mdap.alipay.com', None, '未知', 32.28, 100.0, 15.47, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'applog.uc.cn', None, '未知', 39.27, 100.0, 45.15, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'entphz.alipay.com', None, '未知', 24.22, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'oauth-login.platform.hicloud.com', None, '未知', 32.94, 100.0, 49.42, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'setting1.hicloud.com', None, '未知', 20.74, 100.0, 22.98, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'grs.dbankcloud.com', None, '未知', 28.02, 100.0, 48.24, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'hihealthbase-drcn.things.hicloud.com', None, '未知', 23.25, 100.0, 39.07, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'hihealthbase-drcn.things.hicloud.com', None, '未知', 23.25, 100.0, 38.78, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 42.24, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 44.74, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 34.45, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'render.yunfengdie.cn', None, '未知', 104.7, 100.0, 42.95, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'res.wx.qq.com', None, '未知', 22.77, 100.0, 38.65, 0)]
02-15 21:48:31 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:48:31 PM - ERROR -mysql_db:  exception:(1054, "Unknown column 't_modbile' in 'field list'") [rollback] sql:INSERT INTO tb_domain (uuid,domain,ip,t_modbile,company,dnsreplydelay,tcpbuilddelay,dns_suc_rate,tcp_suc_rate) values(%s,%s,%s,%s,%s,%s,%s,%s,%s)
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 75, in update
    self._cursor.executemany(sql, args)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 197, in executemany
    self._get_db().encoding)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 234, in _do_execute_many
    rows += self.execute(sql + postfix)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.InternalError: (1054, "Unknown column 't_modbile' in 'field list'")
02-15 21:48:31 PM - ERROR -mysql_db:  [('cad50fe2-9e34-023f-2d29-99d1988026ac', '49.4.37.107', 'api.cloud.huawei.com', None, '未知', 23.1, 12.5, 40.91, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '49.4.37.107', 'api.cloud.huawei.com', None, '未知', 23.1, 12.5, 41.89, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '101.226.211.106', 'dns.weixin.qq.com', None, '未知', 21.04, 16.67, 85.18, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '203.119.211.252', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 37.84, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '180.97.104.187', 'loc.map.baidu.com', None, '未知', 22.41, 33.33, 21.01, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '180.97.104.187', 'loc.map.baidu.com', None, '未知', 22.41, 33.33, 18.14, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '74.125.204.108', 'ti-in-f108.1e100.net', None, '未知', 88.64, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '74.125.204.108', 'ti-in-f108.1e100.net', None, '未知', 88.64, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '150.138.180.237', 'www.taobao.com', None, '未知', 25.87, 33.33, 27.29, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '140.205.60.11', 'restapi.amap.com', None, '未知', 33.39, 33.33, 13.83, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '58.58.80.249', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 23.4, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '118.194.33.204', 'metrics1.data.hicloud.com', None, '未知', 32.89, 33.33, 36.01, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '106.11.249.212', 'apilocate.amap.com', None, '未知', 24.25, 33.33, 13.51, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '106.11.249.212', 'apilocate.amap.com', None, '未知', 24.25, 33.33, 28.27, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '14.116.143.118', 'px.ucweb.com', None, '未知', 24.48, 33.33, 39.11, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '14.116.143.118', 'px.ucweb.com', None, '未知', 24.48, 33.33, 43.03, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '106.11.15.2', 'control.aps.amap.com', None, '未知', 16.73, 100.0, 60.76, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '14.116.143.118', 'px.ucweb.com', None, '未知', 24.48, 33.33, 52.52, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '118.194.33.150', 'data.hicloud.com', None, '未知', 21.41, 33.33, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '180.97.93.23', 'api.map.baidu.com', None, '未知', 26.23, 33.33, 18.68, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '58.58.80.253', 'download.alicdn.com', None, '未知', 26.67, 33.33, 33.61, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '49.4.33.228', 'data.hicloud.com', None, '未知', 21.41, 33.33, 37.73, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '110.76.30.76', 'mobilecns.alipay.com', None, '未知', 22.43, 100.0, 11.7, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '14.116.143.241', 'applog.uc.cn', None, '未知', 39.27, 100.0, 54.37, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '58.58.80.248', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 27.84, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '110.76.30.82', 'mdap.alipay.com', None, '未知', 32.28, 100.0, 15.47, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '14.116.143.241', 'applog.uc.cn', None, '未知', 39.27, 100.0, 45.15, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '110.75.232.99', 'entphz.alipay.com', None, '未知', 24.22, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '49.4.39.204', 'oauth-login.platform.hicloud.com', None, '未知', 32.94, 100.0, 49.42, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '122.112.227.176', 'setting1.hicloud.com', None, '未知', 20.74, 100.0, 22.98, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '49.4.35.47', 'grs.dbankcloud.com', None, '未知', 28.02, 100.0, 48.24, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '117.78.15.29', 'hihealthbase-drcn.things.hicloud.com', None, '未知', 23.25, 100.0, 39.07, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '117.78.15.29', 'hihealthbase-drcn.things.hicloud.com', None, '未知', 23.25, 100.0, 38.78, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '58.58.80.249', 'gw.alipayobjects.com', None, '未知', 21.28, 14.29, 42.24, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '203.119.211.252', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 44.74, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '203.119.211.252', 'cgicol.amap.com', None, '未知', 21.05, 25.0, 34.45, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '140.249.40.231', 'render.yunfengdie.cn', None, '未知', 104.7, 100.0, 42.95, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', '150.138.232.8', 'res.wx.qq.com', None, '未知', 22.77, 100.0, 38.65, 0)]
02-15 21:49:00 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:58:02 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:58:17 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 21:58:17 PM - ERROR -mysql_db:  exception:(1054, "Unknown column 'server_ip' in 'field list'") [rollback] sql:INSERT INTO tb_domain (uuid, domain, server_ip, t_mobile, company, dns_delay, dns_suc, Tcpbulddelay, tcp_suc_rate) values(%s,%s,%s,%s,%s,%s,%s,%s,%s)
Traceback (most recent call last):
  File "D:\WUYE\APP\DB\mysql_db.py", line 75, in update
    self._cursor.executemany(sql, args)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 197, in executemany
    self._get_db().encoding)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 234, in _do_execute_many
    rows += self.execute(sql + postfix)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 170, in execute
    result = self._query(query)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\cursors.py", line 328, in _query
    conn.query(q)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 517, in query
    self._affected_rows = self._read_query_result(unbuffered=unbuffered)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 732, in _read_query_result
    result.read()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 1075, in read
    first_packet = self.connection._read_packet()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\connections.py", line 684, in _read_packet
    packet.check_error()
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\protocol.py", line 220, in check_error
    err.raise_mysql_exception(self._data)
  File "C:\Users\Administrator\AppData\Local\Programs\Python\Python37-32\lib\site-packages\pymysql\err.py", line 109, in raise_mysql_exception
    raise errorclass(errno, errval)
pymysql.err.InternalError: (1054, "Unknown column 'server_ip' in 'field list'")
02-15 21:58:17 PM - ERROR -mysql_db:  [('cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.cloud.huawei.com', '49.4.37.107', None, '未知', 23.1, 12.5, 40.91, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.cloud.huawei.com', '49.4.37.107', None, '未知', 23.1, 12.5, 41.89, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'dns.weixin.qq.com', '101.226.211.106', None, '未知', 21.04, 16.67, 85.18, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', '203.119.211.252', None, '未知', 21.05, 25.0, 37.84, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'loc.map.baidu.com', '180.97.104.187', None, '未知', 22.41, 33.33, 21.01, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'loc.map.baidu.com', '180.97.104.187', None, '未知', 22.41, 33.33, 18.14, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'ti-in-f108.1e100.net', '74.125.204.108', None, '未知', 88.64, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'ti-in-f108.1e100.net', '74.125.204.108', None, '未知', 88.64, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'www.taobao.com', '150.138.180.237', None, '未知', 25.87, 33.33, 27.29, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'restapi.amap.com', '140.205.60.11', None, '未知', 33.39, 33.33, 13.83, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', '58.58.80.249', None, '未知', 21.28, 14.29, 23.4, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'metrics1.data.hicloud.com', '118.194.33.204', None, '未知', 32.89, 33.33, 36.01, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'apilocate.amap.com', '106.11.249.212', None, '未知', 24.25, 33.33, 13.51, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'apilocate.amap.com', '106.11.249.212', None, '未知', 24.25, 33.33, 28.27, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', '14.116.143.118', None, '未知', 24.48, 33.33, 39.11, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', '14.116.143.118', None, '未知', 24.48, 33.33, 43.03, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'control.aps.amap.com', '106.11.15.2', None, '未知', 16.73, 100.0, 60.76, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'px.ucweb.com', '14.116.143.118', None, '未知', 24.48, 33.33, 52.52, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'data.hicloud.com', '118.194.33.150', None, '未知', 21.41, 33.33, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'api.map.baidu.com', '180.97.93.23', None, '未知', 26.23, 33.33, 18.68, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'download.alicdn.com', '58.58.80.253', None, '未知', 26.67, 33.33, 33.61, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'data.hicloud.com', '49.4.33.228', None, '未知', 21.41, 33.33, 37.73, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'mobilecns.alipay.com', '110.76.30.76', None, '未知', 22.43, 100.0, 11.7, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'applog.uc.cn', '14.116.143.241', None, '未知', 39.27, 100.0, 54.37, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', '58.58.80.248', None, '未知', 21.28, 14.29, 27.84, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'mdap.alipay.com', '110.76.30.82', None, '未知', 32.28, 100.0, 15.47, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'applog.uc.cn', '14.116.143.241', None, '未知', 39.27, 100.0, 45.15, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'entphz.alipay.com', '110.75.232.99', None, '未知', 24.22, 100.0, 0, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'oauth-login.platform.hicloud.com', '49.4.39.204', None, '未知', 32.94, 100.0, 49.42, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'setting1.hicloud.com', '122.112.227.176', None, '未知', 20.74, 100.0, 22.98, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'grs.dbankcloud.com', '49.4.35.47', None, '未知', 28.02, 100.0, 48.24, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'hihealthbase-drcn.things.hicloud.com', '117.78.15.29', None, '未知', 23.25, 100.0, 39.07, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'hihealthbase-drcn.things.hicloud.com', '117.78.15.29', None, '未知', 23.25, 100.0, 38.78, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'gw.alipayobjects.com', '58.58.80.249', None, '未知', 21.28, 14.29, 42.24, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', '203.119.211.252', None, '未知', 21.05, 25.0, 44.74, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'cgicol.amap.com', '203.119.211.252', None, '未知', 21.05, 25.0, 34.45, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'render.yunfengdie.cn', '140.249.40.231', None, '未知', 104.7, 100.0, 42.95, 0), ('cad50fe2-9e34-023f-2d29-99d1988026ac', 'res.wx.qq.com', '150.138.232.8', None, '未知', 22.77, 100.0, 38.65, 0)]
02-15 21:59:34 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 22:00:06 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 22:08:47 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 22:08:53 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 23:18:06 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 23:19:24 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
02-15 23:20:02 PM - DEBUG -mysql_db:  connect mysql: root@tcp(127.0.0.1):3306
